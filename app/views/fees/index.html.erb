<% content_for :title, "Fees" %>

<div class="page-header">
  <div>
    <h1 class="page-header__title">Fees</h1>
    <p class="page-header__subtitle">Manage tuition and fee records.</p>
  </div>

  <div class="page-actions">
    <% if current_user.admin? || current_user.teacher? %>
      <%= link_to "New Fee", new_fee_path, class: "btn btn-primary" %>
    <% end %>
  </div>
</div>

<div class="card">
  <div class="table-container">
    <table class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Student</th>
          <th>Amount</th>
          <th>Due Date</th>
          <th>Status</th>
          <th>Receipt #</th>
          <th class="no-sort">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @fees.each do |fee| %>
          <tr>
            <td><%= fee.id %></td>
            <td><%= fee.student&.full_name || "—" %></td>
            <td><%= number_to_currency(fee.amount || 0) %></td>
            <td><%= fee.due_date&.strftime("%B %d, %Y") || "—" %></td>
            <td>
              <% if fee.status.present? %>
                <span class="status-badge status-<%= fee.status %>"><%= fee.status.humanize %></span>
              <% else %>
                —
              <% end %>
            </td>
            <td><%= fee.receipt_number.presence || "—" %></td>
            <td>
              <%= link_to "View", fee, class: "btn btn-sm" %>

              <% if current_user.admin? || current_user.teacher? %>
                <%= link_to "Edit", edit_fee_path(fee), class: "btn btn-ghost btn-sm" %>
              <% end %>

              <% if current_user.admin? %>
                <%= link_to "Delete", fee,
                      method: :delete,
                      data: { confirm: "Delete this fee record?" },
                      class: "btn btn-ghost btn-sm" %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <% if @fees.empty? %>
    <div style="padding:18px;">
      <div class="form-help">No fee records found.</div>
      <% if current_user.admin? || current_user.teacher? %>
        <div style="margin-top:12px;">
          <%= link_to "Create Fee", new_fee_path, class: "btn btn-primary" %>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
