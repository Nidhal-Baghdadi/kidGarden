<div class="messaging-sidebar__list">
  <% conversations.each do |conversation| %>
    <% other  = conversation.other_participant(current_user) %>
    <% last   = conversation.last_message %>
    <% unread = unread_counts[conversation.id].to_i %>
    <% active = (defined?(current_conversation) && current_conversation == conversation) %>

    <%= link_to conversation_messages_path(conversation), class: "chat-item #{'is-active' if active}" do %>
      <div class="chat-item__avatar">
        <%= other&.name&.first&.upcase || "?" %>
      </div>

      <div class="chat-item__content">
        <div class="chat-item__top">
          <div class="chat-item__name"><%= other&.name || "Unknown" %></div>
          <div class="chat-item__time">
            <%= last ? last.created_at.strftime("%b %d") : "" %>
          </div>
        </div>

        <div class="chat-item__preview">
          <% if unread > 0 %>
            <strong style="color: var(--primary);"><%= unread %> new â€¢ </strong>
          <% end %>
          <%= last&.content.to_s.truncate(40) || "Start a conversation" %>
        </div>
      </div>
    <% end %>
  <% end %>

  <% if conversations.empty? %>
    <div class="text-frame" style="margin: 20px;">No conversations yet.</div>
  <% end %>
</div>
