<div class="card">
  <div class="card__header">
    <h1 class="card__title">Invoices</h1>
    <div class="card__actions">
      <%= link_to 'New Invoice', new_invoice_path, class: 'btn btn-primary' %>
    </div>
  </div>

  <!-- Filters -->
  <div class="card__section mb-6">
    <%= form_with url: invoices_path, method: :get, local: true, class: "grid grid-cols-1 md:grid-cols-4 gap-4" do |form| %>
      <div>
        <%= form.label :student_id, "Student", class: "form-label" %>
        <%= form.select :student_id, options_from_collection_for_select(Student.all, :id, :full_name, params[:student_id]), { include_blank: "All Students" }, { class: "form-control" } %>
      </div>

      <div>
        <%= form.label :status, "Status", class: "form-label" %>
        <%= form.select :status, options_for_select([["Pending", "pending"], ["Paid", "paid"], ["Overdue", "overdue"], ["Cancelled", "cancelled"], ["Partially Paid", "partially_paid"]], params[:status]), { include_blank: "All Statuses" }, { class: "form-control" } %>
      </div>

      <div>
        <%= form.label :month, "Month", class: "form-label" %>
        <%= form.select :month, options_for_select((1..12).map { |m| [Date::MONTHNAMES[m], m] }, params[:month].to_i), { include_blank: "Any Month" }, { class: "form-control" } %>
      </div>

      <div>
        <%= form.label :year, "Year", class: "form-label" %>
        <% years = ((Date.current.year - 2)..(Date.current.year + 1)).to_a %>
        <%= form.select :year, options_for_select(years.map { |y| [y, y] }, params[:year].to_i), { include_blank: "Any Year" }, { class: "form-control" } %>
      </div>

      <div class="md:col-span-4 flex gap-2">
        <%= form.submit "Filter", class: "btn btn-primary" %>
        <%= link_to "Clear", invoices_path, class: "btn" %>
      </div>
    <% end %>
  </div>

  <!-- Invoices Table -->
  <div class="table-container">
    <table class="table">
      <thead>
        <tr>
          <th>Invoice #</th>
          <th>Student</th>
          <th>Parent</th>
          <th>Month/Year</th>
          <th>Amount</th>
          <th>Due Date</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @invoices.each do |invoice| %>
          <tr>
            <td><%= invoice.invoice_number %></td>
            <td><%= invoice.student.full_name %></td>
            <td><%= invoice.parent.name %></td>
            <td><%= Date.new(invoice.year, invoice.month, 1).strftime("%B %Y") %></td>
            <td><%= number_to_currency(invoice.total_amount, unit: "$") %></td>
            <td><%= invoice.due_date.strftime("%b %d, %Y") %></td>
            <td><%= status_badge(invoice.status) %></td>
            <td class="whitespace-nowrap">
              <div class="flex gap-2">
                <%= link_to 'View', invoice, class: 'btn btn-sm' %>
                <%= link_to 'Edit', edit_invoice_path(invoice), class: 'btn btn-sm btn-primary' %>
                <%= link_to 'PDF', download_pdf_invoice_path(invoice), class: 'btn btn-sm', target: '_blank' %>
                <%= link_to 'Delete', invoice, method: :delete,
                            confirm: 'Are you sure?',
                            class: 'btn btn-sm btn-danger' %>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <% if @invoices.empty? %>
      <div class="text-center py-8">
        <p class="text-muted">No invoices found.</p>
        <%= link_to 'Create a new invoice', new_invoice_path, class: 'btn btn-primary mt-2' %>
      </div>
    <% end %>
  </div>
</div>