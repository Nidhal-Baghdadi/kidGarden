<div class="card">
  <div class="card__header">
    <h1 class="card__title">Invoice <%= @invoice.invoice_number %></h1>
    <div class="card__actions">
      <%= link_to 'Download PDF', download_pdf_invoice_path(@invoice), class: 'btn btn-primary', target: '_blank' %>
      <%= link_to 'Edit', edit_invoice_path(@invoice), class: 'btn btn-primary' %>
      <%= link_to 'Back to Invoices', invoices_path, class: 'btn' %>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Invoice Details -->
    <div class="lg:col-span-2">
      <div class="card">
        <div class="card__section">
          <h2 class="card__subtitle">Invoice Details</h2>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div>
            <p class="text-label">Invoice Number</p>
            <p class="text-value"><%= @invoice.invoice_number %></p>
          </div>

          <div>
            <p class="text-label">Issue Date</p>
            <p class="text-value"><%= @invoice.issue_date.strftime("%B %d, %Y") %></p>
          </div>

          <div>
            <p class="text-label">Due Date</p>
            <p class="text-value"><%= @invoice.due_date.strftime("%B %d, %Y") %></p>
          </div>

          <div>
            <p class="text-label">Status</p>
            <p class="text-value"><%= status_badge(@invoice.status) %></p>
          </div>

          <div>
            <p class="text-label">Student</p>
            <p class="text-value"><%= @invoice.student.full_name %></p>
          </div>

          <div>
            <p class="text-label">Parent/Guardian</p>
            <p class="text-value"><%= @invoice.parent.name %></p>
          </div>

          <div>
            <p class="text-label">Month/Year</p>
            <p class="text-value"><%= @invoice.month_year %></p>
          </div>

          <div>
            <p class="text-label">Total Amount</p>
            <p class="text-value text-xl font-bold"><%= number_to_currency(@invoice.total_amount, unit: "$") %></p>
          </div>
        </div>

        <% if @invoice.notes.present? %>
          <div class="mb-6">
            <p class="text-label">Notes</p>
            <p class="text-value"><%= @invoice.notes %></p>
          </div>
        <% end %>

        <h3 class="card__subtitle">Invoice Items</h3>
        <div class="table-container">
          <table class="table">
            <thead>
              <tr>
                <th>Description</th>
                <th>Amount</th>
              </tr>
            </thead>
            <tbody>
              <% @invoice.invoice_items.each do |item| %>
                <tr>
                  <td><%= item.description %></td>
                  <td><%= number_to_currency(item.amount, unit: "$") %></td>
                </tr>
              <% end %>
              <tr class="font-bold">
                <td class="text-right">Total</td>
                <td><%= number_to_currency(@invoice.total_amount, unit: "$") %></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      </div>
    </div>

    <!-- Summary Panel -->
    <div class="card">
      <div class="card__section">
        <h2 class="card__subtitle">Summary</h2>

        <div class="space-y-4">
          <div class="flex justify-between">
            <span class="text-muted">Total Amount:</span>
            <span class="font-medium"><%= number_to_currency(@invoice.total_amount, unit: "$") %></span>
          </div>

          <div class="flex justify-between">
            <span class="text-muted">Amount Paid:</span>
            <span class="font-medium"><%= number_to_currency(@invoice.amount_paid, unit: "$") %></span>
          </div>

          <div class="flex justify-between">
            <span class="text-muted">Balance Remaining:</span>
            <span class="font-medium"><%= number_to_currency(@invoice.balance_remaining, unit: "$") %></span>
          </div>

          <div class="pt-4" style="border-top: 1px solid var(--border);">
            <p class="text-muted">Days Until Due:</p>
            <p class="text-lg font-semibold">
              <% if @invoice.due_soon? %>
                <span class="text-warning"><%= @invoice.days_until_due %> days</span>
              <% elsif @invoice.overdue? %>
                <span class="text-danger"><%= @invoice.days_until_due.abs %> days overdue</span>
              <% else %>
                <span class="text-success"><%= @invoice.days_until_due %> days</span>
              <% end %>
            </p>
          </div>
        </div>

        <div class="mt-6">
          <h3 class="card__subtitle mb-2">Actions</h3>
          <div class="space-y-2">
            <%= link_to 'Mark as Paid', invoice_path(@invoice, invoice: { status: 'paid' }),
                        method: :patch,
                        class: 'btn btn-success w-full',
                        confirm: 'Are you sure you want to mark this invoice as paid?' %>

            <%= link_to 'Send Reminder', '#',
                        class: 'btn btn-primary w-full' %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>