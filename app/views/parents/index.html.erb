<% content_for :title, "Parents" %>

<div class="page-header">
  <div>
    <h1 class="page-header__title">Parents</h1>
    <p class="page-header__subtitle">Manage parent accounts and linked children</p>
  </div>

  <div class="page-actions">
    <% if current_user.admin? %>
      <%= link_to "New Parent", new_parent_path, class: "btn btn-primary" %>
    <% end %>
  </div>
</div>

<div class="card">
  <% if @parents.any? %>
    <div class="table-container">
      <table class="table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Children</th>
            <th class="no-sort">Actions</th>
          </tr>
        </thead>

        <tbody>
          <% @parents.each do |parent| %>
            <tr>
              <td><%= parent.name %></td>
              <td><%= parent.email %></td>
              <td><%= parent.phone.presence || "â€”" %></td>

              <td>
                <% if parent.students_as_parent.any? %>
                  <div style="display:flex; flex-direction:column; gap:4px;">
                    <% parent.students_as_parent.limit(3).each do |student| %>
                      <div><%= student.first_name %> <%= student.last_name %></div>
                    <% end %>

                    <% if parent.students_as_parent.count > 3 %>
                      <div class="form-help">
                        â€¦and <%= parent.students_as_parent.count - 3 %> more
                      </div>
                    <% end %>
                  </div>
                <% else %>
                  <span class="form-help">No children assigned</span>
                <% end %>
              </td>

              <td>
                <div style="display:flex; gap:8px; flex-wrap:wrap;">
                  <%= link_to "View", parent, class: "btn btn-sm" %>

                  <% if current_user.admin? %>
                    <%= link_to "Edit", edit_parent_path(parent), class: "btn btn-sm" %>
                    <%= link_to "Delete", parent,
                        method: :delete,
                        data: { confirm: "Are you sure?" },
                        class: "btn btn-ghost btn-sm" %>
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

  <% else %>
    <div style="text-align:center; padding: 28px 12px;">
      <div style="font-weight: 750; font-size: 1.05rem;">No parents</div>
      <div class="form-help" style="margin-top: 6px;">
        Get started by creating a new parent account.
      </div>

      <% if current_user.admin? %>
        <div style="margin-top: 14px;">
          <%= link_to "Add Parent", new_parent_path, class: "btn btn-primary" %>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
